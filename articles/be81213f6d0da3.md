---
title: "éåŒæœŸå‡¦ç†ãŒçµ‚ã‚ã‚‹ã¾ã§å¾…æ©Ÿã•ã›ã‚‹[Kotlin]"
emoji: "ğŸŒ"
type: "tech"
topics: ["android", "kotlin", "coroutine"]
published: true
---

# ã‚„ã‚ŠãŸã„ã“ã¨

coroutine ã¨ã‹ã«å¯¾å¿œã—ã¦ãªã„ã‚³ãƒ¼ãƒ‰ã§ã€éåŒæœŸå‡¦ç†ã®å®Œäº†ã‚’ callback ã¨ã‹ä½¿ã‚ãšã«ã‚·ãƒ³ãƒ—ãƒ«ã«å¾…ã¡ãŸã„ã€‚

# èª²é¡Œ

ã“ã†ã„ã†ã‚³ãƒ¼ãƒ‰ã ã¨ã€result ã®å–å¾—ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åˆ¶å¾¡ã—ã¥ã‚‰ã„ã€‚

```kotlin
# å‡¦ç†å®Œäº†æ™‚ã« result or password ãŒå‘¼ã°ã‚Œã‚‹ã€‚
# ãã®é–“ã€å‡¦ç†ã¯ä¸­æ–­ã•ã‚Œãšæ¬¡ã®è¡Œã¸é€²ã‚€
Amplify.Auth.signIn(
    username,
    password,
    { result ->
        Log.i(
            "AuthQuickstart",
            if (result.isSignInComplete) "Sign in succeeded" else "Sign in not complete"
        )
    },
    { error -> Log.e("AuthQuickstart", error.toString()) }
)
```

AWS Amplify: [https://docs.amplify.aws/lib/auth/getting-started/q/platform/android#configure-auth-category](https://docs.amplify.aws/lib/auth/getting-started/q/platform/android#configure-auth-category)

# è§£æ±ºç­–

## suspendCoroutine ã‚’ä½¿ã†

LoginRepository.kt

```kotlin
import com.amplifyframework.core.Amplify
import kotlin.coroutines.resume
import kotlin.coroutines.suspendCoroutine

sealed class Result<out R> {
    data class Success<out T>(val data: T) : Result<T>()
    data class Error(val exception: Exception) : Result<Nothing>()
}

class LoginRepository {
    suspend fun makeLoginRequest(username: String, password: String): Result<String> {
        return suspendCoroutine { continuation ->
            Amplify.Auth.signIn(
                username,
                password,
                { res ->
                    val result =
                        Result.Success(if (res.isSignInComplete) "Sign in succeeded" else "Sign in not complete")
                    continuation.resume(result)
                },
                { error ->
                    val result = Result.Error(Exception(error.toString()))
                    continuation.resume(result)
                }
            )
        }
    }
}
```

`continuation.resume` ãŒå‘¼ã°ã‚Œã‚‹ã¾ã§ `suspendCoroutine` ãŒå¾…ã£ã¦ãã‚Œã¦ã€ `continuation.resume(result)` ã® `result` ã‚’ return ã—ã¦ãã‚Œã‚‹ã€‚

## å‘¼ã³å‡ºã—å´

ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã®å®Œäº†ã‚’å¾…ã£ã¦ã‹ã‚‰ `startMainActivity()` ãŒå‘¼ã°ã‚Œã‚‹ã€‚

MainActivity.kt

```kotlin
private fun login(username: String, password: String) = MainScope().launch(Dispatchers.Main) {
    when (val result = loginRepository.makeLoginRequest(username, password)) {
        is Result.Success<String> -> Log.i("LoginActivity", result.data)
        else -> Log.e("LoginActivity", result.toString())
    }
    startMainActivity()
}
```

## suspendCoroutine ã¨ã¯

https://droidkaigi.github.io/codelabs-kotlin-coroutines-ja/#6

[https://droidkaigi.github.io/codelabs-kotlin-coroutines-ja/#6](https://droidkaigi.github.io/codelabs-kotlin-coroutines-ja/#6)  
ã“ã®ã‚ãŸã‚ŠãŒè‰¯ã•ãã†ãªã€ã¨ã„ã†ã‹ã€ã“ã‚Œã‚’èª­ã‚ã°ã“ã®è¨˜äº‹ã„ã‚‰ãªãã†â€¦

# ã‚ã¨ãŒã

Good ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã¯ãªã„æ°—ã¯ã—ã¦ã„ã‚‹ã€‚  
ä»Šå›ä¾‹ã¨ã—ã¦æŒ™ã’ãŸ `Amplify` ã§ã¯ã€ã‚ˆã‚Šè‰¯ã„å½¢ãŒã“ã“ã§è­°è«–ã•ã‚Œã¦ã„ãã†ã€‚  

https://github.com/aws-amplify/amplify-android/issues/605

[https://github.com/aws-amplify/amplify-android/issues/605](https://github.com/aws-amplify/amplify-android/issues/605)

# ã‚¹ã‚¯ãƒ©ãƒƒãƒ—

-   [https://zenn.dev/tktcorporation/scraps/5f2088b0fdc3f5](https://zenn.dev/tktcorporation/scraps/5f2088b0fdc3f5)

# å‚è€ƒ

-   [https://stackoverflow.com/questions/62270000/how-to-save-data-from-a-kotlin-asynchronous-closure](https://stackoverflow.com/questions/62270000/how-to-save-data-from-a-kotlin-asynchronous-closure)